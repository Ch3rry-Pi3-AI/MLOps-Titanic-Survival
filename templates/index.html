<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/static/style.css" />
    <title>Titanic Survival Prediction</title>
</head>
<body>
    <div class="shell">
        <header class="page-header">
            <h1>Titanic Survival Prediction</h1>
        </header>

        <main class="two-col">
            <!-- Left column: inputs -->
            <section class="col">
                <div class="card">
                    <h3 class="card-title">Passenger Inputs</h3>
                    <form action="/predict" method="POST" class="prediction-form" id="prediction-form">
                        <!-- Age -->
                        <div class="form-group">
                            <label for="Age">Age</label>
                            <input type="number" id="Age" name="Age" required step="1" min="0" max="120" placeholder="e.g. 29" />
                        </div>

                        <!-- Fare -->
                        <div class="form-group">
                            <label for="Fare">Fare</label>
                            <input type="number" id="Fare" name="Fare" required step="1" min="0" max="10000" placeholder="e.g. 72" />
                        </div>

                        <!-- Passenger Class (was Pclass) -->
                        <div class="form-group">
                            <label for="Pclass">Passenger Class</label>
                            <select id="Pclass" name="Pclass" required>
                                <option value="" disabled selected>Select class</option>
                                <option value="1">First</option>
                                <option value="2">Second</option>
                                <option value="3">Third</option>
                            </select>
                        </div>

                        <!-- Sex -->
                        <div class="form-group">
                            <label for="Sex">Sex</label>
                            <select id="Sex" name="Sex" required>
                                <option value="0">Male</option>
                                <option value="1">Female</option>
                            </select>
                        </div>

                        <!-- Embarked -->
                        <div class="form-group">
                            <label for="Embarked">Embarked</label>
                            <select id="Embarked" name="Embarked" required>
                                <option value="0">Cherbourg</option>
                                <option value="1">Queenstown</option>
                                <option value="2">Southampton</option>
                            </select>
                        </div>

                        <!-- Family size -->
                        <div class="form-group">
                            <label for="Familysize">Family Size</label>
                            <input type="number" id="Familysize" name="Familysize" required step="1" min="0" max="15" placeholder="e.g. 2" />
                        </div>

                        <!-- Is alone -->
                        <div class="form-group">
                            <label for="Isalone">Is Alone</label>
                            <select id="Isalone" name="Isalone" required>
                                <option value="1">Yes</option>
                                <option value="0">No</option>
                            </select>
                        </div>

                        <!-- Has cabin -->
                        <div class="form-group">
                            <label for="HasCabin">Has Cabin</label>
                            <select id="HasCabin" name="HasCabin" required>
                                <option value="1">Yes</option>
                                <option value="0">No</option>
                            </select>
                        </div>

                        <!-- Title -->
                        <div class="form-group">
                            <label for="Title">Title</label>
                            <select id="Title" name="Title" required>
                                <option value="" disabled selected>Select title</option>
                                <option value="0">Mr</option>
                                <option value="1">Miss</option>
                                <option value="2">Mrs</option>
                                <option value="3">Master</option>
                                <option value="4">Rare</option>
                            </select>
                        </div>

                        <button type="submit" class="btn">Predict</button>
                    </form>

                    {% if error_text %}
                    <div class="alert error">
                        {{ error_text }}
                    </div>
                    {% endif %}
                </div>
            </section>

            <!-- Right column: Prediction Summary (top) + Drift Detector -->
            <section class="col">
                <!-- Prediction Summary FIRST -->
                <div class="card">
                    <h3 class="card-title">Prediction Summary</h3>
                    <div class="prediction-result">
                        {% if prediction_label %}
                            {% set is_survived = 'SURVIVED' in prediction_label|upper %}
                            <p class="pred-label {{ 'pred-survived' if is_survived else 'pred-not' }}">
                                {{ prediction_label }}
                            </p>
                            {% if prediction_sentence %}
                                <p class="pred-sentence">{{ prediction_sentence }}</p>
                            {% endif %}
                            {% if prediction_prob is not none %}
                                <p><strong>Estimated probability of survival:</strong> {{ prediction_prob }}%</p>
                            {% endif %}
                        {% else %}
                            <p class="muted">No predictions yet made…</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Drift Detector BELOW (with explicit gap) -->
                <div class="card drift-panel">
                    <h3 class="card-title">Drift Detector</h3>
                    {% if drift is not none %}
                        <p class="drift-status">
                            <strong>Status:</strong>
                            {% if drift.is_drift %}
                                <span class="drift-yes">Drift evidenced</span>
                            {% else %}
                                <span class="drift-no">No drift evidenced</span>
                            {% endif %}
                            &nbsp;|&nbsp;<strong>α = </strong>{{ drift.alpha }}
                        </p>

                        <div class="table-wrap">
                            <table class="drift-table">
                                <thead>
                                    <tr>
                                        <th class="col-feature">Feature</th>
                                        <th class="col-pval">p-value</th>
                                        <th class="col-flag">Flagged</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for row in drift.rows %}
                                    <tr>
                                        <td>{{ row.feature }}</td>
                                        <td class="pval-cell">{{ row.pval }}</td>
                                        <td class="flag-cell">
                                            {% if row.flagged %}
                                                <span class="flag-yes" title="Flagged below α">⚠️</span>
                                            {% else %}
                                                <span class="flag-no">—</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        {% if drift.flagged_features and drift.is_drift %}
                            <p class="drift-note"><strong>Possible drivers:</strong> {{ drift.flagged_features|join(', ') }}</p>
                        {% endif %}
                    {% else %}
                        <p class="muted">No drift check run yet.</p>
                    {% endif %}
                </div>
            </section>
        </main>
    </div>
</body>
</html>
